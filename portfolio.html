<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portfolio | Carissa Micháe</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />
</head>

<body class="portfolio-page">
<!-- Portfolio Background Video -->
<div class="portfolio-bg" aria-hidden="true">
  <video class="portfolio-bg-video" autoplay muted loop playsinline preload="metadata">
    <source src="videos/Carissa.mp4" type="video/mp4">
  </video>
</div>
  <!-- =========================================================
       Portfolio Page
       - Uses global styles.css for layout + grid styling
       - Uses script.js for year + reveal + lightbox
       - Adds local arrow scroller logic (only for this page)
       ========================================================= -->

  <div class="page-wrap">

    <header class="site-header">
      <div class="brand">
        <div class="brand-name">Carissa Micháe</div>
        <div class="brand-subtitle">Professional · Commercial · Editorial · Lifestyle</div>
      </div>

      <nav class="nav" aria-label="Primary navigation">
        <a href="index.html#home" class="nav-link">Home</a>
        <a href="portfolio.html" class="nav-link" aria-current="page">Portfolio</a>
        <a href="about.html" class="nav-link">About</a>
        <a href="contact.html" class="nav-link">Contact</a>
      </nav>
    </header>

    <main>
      <!-- PORTFOLIO -->
      <section class="section" aria-label="Portfolio">
        <div class="section-header">
          <h2>Portfolio</h2>
          <p class="muted">Browse the full collection.</p>
          </br>
        </div>

        <!-- =========================================================
             Horizontal 2-row gallery + arrows
             - Buttons scroll the grid left/right
             - Buttons auto-disable at the ends
             ========================================================= -->
        <div class="h-gallery" aria-label="Scrollable photo gallery">
          <button class="h-arrow h-arrow-left" type="button" aria-label="Scroll left">
            <span class="arrow-glyph" aria-hidden="true">›</span>
          </button>

          <div class="grid h-grid">
            <img alt="Full body 1" src="images/fullbody1.JPG" />
            <img alt="Full body 2" src="images/new2.jpeg" />
            <img alt="Full body 3" src="images/new6.JPG" />
            <img alt="Full body 4" src="images/enter6.JPEG" />
            <img alt="Full body 5" src="images/enter.jpeg" />
            <img alt="Full body 6" src="images/full1.png" />
            <img alt="Full body 8" src="images/full3.jpeg" />
            <img alt="Full body 9" src="images/full4.jpeg" />
            <img alt="Full body 11" src="images/new4.JPG" />
            <img alt="Full body 12" src="images/new1.JPG" />
            <img alt="Headshot 1" src="images/headshot2.JPG" />
            <img alt="Headshot 2" src="images/headshot3.JPG" />
            <img alt="Headshot 3" src="images/new7.JPG" />
            <img alt="Headshot 4" src="images/head1.jpeg" />
            <img alt="Headshot 6" src="images/new3.jpeg" />
            <img alt="Profile 1" src="images/headshot1.JPEG" />
            <img alt="Profile 2" src="images/enter3.JPG" />
            <img alt="Profile 3" src="images/fullbody2.JPEG" />
            <img alt="Profile 4" src="images/prof2.JPEG" />
            <img alt="Profile 5" src="images/fullbody3.JPG" />
          </div>

          <!-- Custom chrome scrollbar (added only) -->
          <div class="chrome-scroll" aria-label="Gallery scrollbar">
            <div class="chrome-thumb" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
          </div>

          <button class="h-arrow h-arrow-right" type="button" aria-label="Scroll right">
            <span class="arrow-glyph" aria-hidden="true">›</span>
          </button>
        </div>

        <!-- Footer (portfolio page only) -->
        <br>
        <p class="centered-paragraph">© <span id="year"></span> Carissa Micháe · All Rights Reserved</p>
      </section>
    </main>

  </div>

  <!-- =========================================================
       Lightbox (enlarge images)
       - Markup expected by script.js lightbox module
       ========================================================= -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightbox-backdrop" data-close="true"></div>

    <div class="lightbox-dialog" role="dialog" aria-modal="true" aria-label="Enlarged image viewer">
      <button class="lightbox-close" type="button" aria-label="Close" data-close="true">×</button>
      <button class="lightbox-nav lightbox-prev" type="button" aria-label="Previous image">‹</button>

      <figure class="lightbox-figure">
        <img class="lightbox-img" id="lightboxImg" alt="">
      </figure>

      <button class="lightbox-nav lightbox-next" type="button" aria-label="Next image">›</button>
    </div>
  </div>

  <!-- Local helpers -->
  <style>
    .centered-paragraph { text-align: center; }
  </style>

  <!-- Shared site JS (year/reveal/lightbox, etc.) -->
  <script src="script.js"></script>

  <!-- =========================================================
       Portfolio arrow scrolling (page-only)
       - Auto-disables arrows at ends
       - Smooth scroll step based on image width
       ========================================================= -->
  <script>
  (function () {
    const gallery = document.querySelector(".h-gallery");
    if (!gallery) return;

    const scroller = gallery.querySelector(".h-grid");
    const leftBtn = gallery.querySelector(".h-arrow-left");
    const rightBtn = gallery.querySelector(".h-arrow-right");

    if (!scroller || !leftBtn || !rightBtn) return;

    // Make the scroller focusable so keyboard can target it
    if (!scroller.hasAttribute("tabindex")) scroller.setAttribute("tabindex", "0");

    let rafId = 0;
    let animating = false;

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    function clamp(n, min, max) {
      return Math.max(min, Math.min(max, n));
    }

    function setDisabled(btn, disabled) {
      btn.disabled = disabled;
      btn.setAttribute("aria-disabled", disabled ? "true" : "false");
      btn.classList.toggle("is-disabled", disabled);
    }

    function updateButtons() {
      const maxScroll = scroller.scrollWidth - scroller.clientWidth;
      const x = scroller.scrollLeft;

      // tolerance avoids flicker due to subpixel values
      const atStart = x <= 1;
      const atEnd = x >= (maxScroll - 1);

      setDisabled(leftBtn, atStart);
      setDisabled(rightBtn, atEnd);
    }

    /* =========================================================
       ADDED: step = exactly one image + the grid gap (mobile-friendly)
       ========================================================= */
    function getGapPx() {
      const styles = getComputedStyle(scroller);
      // column-gap in modern browsers; fallback to gap
      const gap = styles.columnGap || styles.gap || "16px";
      return parseFloat(gap) || 16;
    }

    function getStep() {
      const firstImg = scroller.querySelector("img");
      const w = firstImg ? firstImg.getBoundingClientRect().width : 240;
      return Math.round(w + getGapPx());
    }

    function smoothScrollTo(targetLeft, duration = 360) {
      cancelAnimationFrame(rafId);

      const start = scroller.scrollLeft;
      const maxScroll = scroller.scrollWidth - scroller.clientWidth;
      const end = clamp(targetLeft, 0, maxScroll);

      if (Math.abs(end - start) < 1) {
        scroller.scrollLeft = end;
        updateButtons();
        return;
      }

      animating = true;
      const t0 = performance.now();

      function tick(now) {
        const t = clamp((now - t0) / duration, 0, 1);
        const eased = easeOutCubic(t);
        scroller.scrollLeft = start + (end - start) * eased;

        updateButtons();

        if (t < 1) {
          rafId = requestAnimationFrame(tick);
        } else {
          animating = false;
          updateButtons();
        }
      }

      rafId = requestAnimationFrame(tick);
    }

    function smoothScrollBy(delta) {
      smoothScrollTo(scroller.scrollLeft + delta);
    }

    /* =========================================================
       ADDED: snap to nearest image so arrows always land "picture by picture"
       ========================================================= */
    function snapToNearest(duration = 180) {
      const imgs = Array.from(scroller.querySelectorAll("img"));
      if (!imgs.length) return;

      const current = scroller.scrollLeft;

      let nearest = imgs[0].offsetLeft;
      let best = Math.abs(nearest - current);

      for (const img of imgs) {
        const p = img.offsetLeft;
        const d = Math.abs(p - current);
        if (d < best) {
          best = d;
          nearest = p;
        }
      }

      smoothScrollTo(nearest, duration);
    }

    // Arrow buttons (UPDATED to snap)
    leftBtn.addEventListener("click", () => {
      smoothScrollBy(-getStep());
      setTimeout(() => snapToNearest(160), 180);
    });

    rightBtn.addEventListener("click", () => {
      smoothScrollBy(getStep());
      setTimeout(() => snapToNearest(160), 180);
    });

    // Wheel/trackpad: make vertical wheel scroll horizontally *while pointer is over the gallery*
    // This removes the “glitchy” feeling a lot.
    scroller.addEventListener(
      "wheel",
      (e) => {
        // If user is holding shift, browsers often already horizontal-scroll; still smooth it
        // Also ignore if lightbox is open
        if (document.body.classList.contains("lightbox-open")) return;

        // Prevent page from scrolling vertically while interacting with the gallery
        e.preventDefault();

        const delta = Math.abs(e.deltaX) > Math.abs(e.deltaY) ? e.deltaX : e.deltaY;
        // Tame huge mouse-wheel deltas
        const tuned = clamp(delta, -120, 120) * 2.2;

        smoothScrollBy(tuned);
      },
      { passive: false }
    );

    // Keyboard support for the gallery (separate from lightbox)
    // Works when the scroller is focused OR when mouse is over the gallery.
    let hover = false;
    gallery.addEventListener("mouseenter", () => (hover = true));
    gallery.addEventListener("mouseleave", () => (hover = false));

    window.addEventListener("keydown", (e) => {
      if (document.body.classList.contains("lightbox-open")) return;

      const active = document.activeElement;
      const focusedScroller = active === scroller;
      if (!focusedScroller && !hover) return;

      const step = getStep();
      let handled = true;

      switch (e.key) {
        case "ArrowLeft":
          smoothScrollBy(-step);
          setTimeout(() => snapToNearest(140), 160);
          break;
        case "ArrowRight":
          smoothScrollBy(step);
          setTimeout(() => snapToNearest(140), 160);
          break;
        case "PageUp":
          smoothScrollBy(-step * 2);
          setTimeout(() => snapToNearest(160), 180);
          break;
        case "PageDown":
          smoothScrollBy(step * 2);
          setTimeout(() => snapToNearest(160), 180);
          break;
        case "Home":
          smoothScrollTo(0, 420);
          break;
        case "End":
          smoothScrollTo(scroller.scrollWidth, 420);
          break;
        default:
          handled = false;
      }

      if (handled) e.preventDefault();
    });

    // Keep arrow disable state correct
    scroller.addEventListener(
      "scroll",
      () => {
        if (!animating) updateButtons();
      },
      { passive: true }
    );

    window.addEventListener("resize", updateButtons);

    // Initial
    updateButtons();

    // =========================================================
    // Custom chrome scrollbar (sync + DRAG)
    // =========================================================
    const chromeTrack = gallery.querySelector(".chrome-scroll");
    const chromeThumb = gallery.querySelector(".chrome-thumb");

    function updateChromeBar(){
      if (!chromeTrack || !chromeThumb) return;

      const maxScroll = scroller.scrollWidth - scroller.clientWidth;
      const trackW = chromeTrack.clientWidth;

      if (maxScroll <= 1){
        chromeTrack.style.display = "none";
        return;
      } else {
        chromeTrack.style.display = "";
      }

      const ratio = scroller.clientWidth / scroller.scrollWidth;
      const thumbW = Math.max(60, Math.round(trackW * ratio));
      const progress = scroller.scrollLeft / maxScroll;
      const maxLeft = trackW - thumbW;
      const left = Math.round(maxLeft * progress);

      chromeThumb.style.width = thumbW + "px";
      chromeThumb.style.transform = `translateX(${left}px)`;
      chromeThumb.setAttribute("aria-valuenow", String(Math.round(progress * 100)));
    }

    // Click on track jumps thumb
    if (chromeTrack && chromeThumb){
      chromeTrack.addEventListener("pointerdown", (e) => {
        if (e.target === chromeThumb) return;

        const rect = chromeTrack.getBoundingClientRect();
        const trackX = e.clientX - rect.left;

        const thumbRect = chromeThumb.getBoundingClientRect();
        const thumbW = thumbRect.width;

        const maxScroll = scroller.scrollWidth - scroller.clientWidth;
        const maxLeft = chromeTrack.clientWidth - thumbW;

        const clampedLeft = Math.max(0, Math.min(maxLeft, trackX - thumbW/2));
        scroller.scrollLeft = (clampedLeft / maxLeft) * maxScroll;
      });

      // Drag thumb like a real scrollbar
      let dragging = false;
      let dragStartX = 0;
      let startLeft = 0;

      chromeThumb.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        chromeThumb.setPointerCapture(e.pointerId);

        dragging = true;
        dragStartX = e.clientX;

        const t = chromeThumb.getBoundingClientRect();
        const r = chromeTrack.getBoundingClientRect();
        startLeft = t.left - r.left;

        chromeThumb.style.animationPlayState = "paused";
      });

      chromeThumb.addEventListener("pointermove", (e) => {
        if (!dragging) return;

        const maxScroll = scroller.scrollWidth - scroller.clientWidth;
        const trackW = chromeTrack.clientWidth;

        const thumbW = chromeThumb.getBoundingClientRect().width;
        const maxLeft = trackW - thumbW;

        const dx = e.clientX - dragStartX;
        const newLeft = Math.max(0, Math.min(maxLeft, startLeft + dx));

        const progress = maxLeft > 0 ? (newLeft / maxLeft) : 0;
        scroller.scrollLeft = progress * maxScroll;
      });

      function endDrag(){
        dragging = false;
        chromeThumb.style.animationPlayState = "";
      }

      chromeThumb.addEventListener("pointerup", endDrag);
      chromeThumb.addEventListener("pointercancel", endDrag);
    }

    scroller.addEventListener("scroll", updateChromeBar, { passive: true });
    window.addEventListener("resize", updateChromeBar);
    updateChromeBar();

  })();
</script>
</body>
</html>